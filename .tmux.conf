# # for image.nvim
# set -gq allow-passthrough on
# set -g visual-activity off
#
# # set -sg escape-time 0
# setw -g mode-keys vi
# set -g status-interval 1
# set -g status-style 'fg=colour7 bg=colour18'
# set -g status-right "#[fg=colour243,bg=colour18]#(taskscript -t)#[fg=colour243,bg=colour19] %Y-%m-%d #[fg=colour7,bg=colour21] %H:%M "
#
# # AI slop to get clipboard working with primary clipboard
# unbind ]
# bind-key ] run-shell 'wl-paste --primary --no-newline | tmux load-buffer -b __primary__ -' \; paste-buffer -p -b __primary__ \; delete-buffer -b __primary__
#
# # Optional: keep the original tmux buffer paste on C-]
# bind-key C-] paste-buffer -p
#
# # If you want yanks from tmux copy-mode to go to Wayland PRIMARY:
# # (requires tmux >= 3.2; documented under set-clipboard and copy-command)
# set -g set-clipboard external
# set -s copy-command 'wl-copy --primary'
#
# # Ensure Wayland vars propagate into tmux so wl-paste/wl-copy work
# # (documented under update-environment)
# set -ga update-environment " WAYLAND_DISPLAY XDG_RUNTIME_DIR"

# for image.nvim
set -gq allow-passthrough on
set -g visual-activity off

setw -g mode-keys vi
set -g status-interval 1
set -g status-style 'fg=colour7 bg=colour18'
set -g status-right "#[fg=colour243,bg=colour18]#(taskscript -t)#[fg=colour243,bg=colour19] %Y-%m-%d #[fg=colour7,bg=colour21] %H:%M "

# Use X11 CLIPBOARD via xclip for tmux copies (works with VMware clipboard sync)
# tmux >= 3.2: external uses copy-command to write the data from stdin
set -g set-clipboard external
set -s copy-command 'xclip -i -selection clipboard'

# Optional: also mirror to PRIMARY if you like select-to-paste behavior in X apps
# set -s copy-command 'xclip -i -selection clipboard -f | xclip -i -selection primary'

# Remove Wayland-specific PRIMARY paste; replace with X11 variants
unbind ]
# Paste from X11 PRIMARY (middle-click style) if you still want a binding:
bind-key ] run-shell 'xclip -o -selection primary | tmux load-buffer -b __primary__ -' \; paste-buffer -p -b __primary__ \; delete-buffer -b __primary__

# Keep original tmux paste on C-]
bind-key C-] paste-buffer -p

bind -T copy-mode-vi y     send -X copy-pipe-and-cancel "xclip -i -selection clipboard"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xclip -i -selection clipboard"

# Ensure X11 environment variables propagate into tmux so xclip works from tmux server
# (remove Wayland vars; include DISPLAY & XAUTHORITY)
set -g update-environment "DISPLAY XAUTHORITY SSH_AUTH_SOCK"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator

# decide whether we're in a Vim process
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'

if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -n 'C-Space' if-shell "$is_vim" 'send-keys C-Space' 'select-pane -t:.+'

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
# bind-key -T copy-mode-vi 'C-\' select-pane -l
# bind-key -T copy-mode-vi 'C-Space' select-pane -t:.+
