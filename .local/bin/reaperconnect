#!/usr/bin/env bash
set -Eeuo pipefail

default="$(pactl get-default-sink)"

links="$(pw-link -lI 2>/dev/null)"

# Use awk to extract IDs:
#   $2 must be the arrow "|<-"
#   $4 must be REAPER:out<number>
# Then sort uniquely (numeric) and load into array.
mapfile -t outIDs < <( awk '$2=="|<-" && $4 ~ /^REAPER:out[0-9]+$/ { print $1 }' <<<"$links")

# Disconnect all connected Reaper outputs
for outID in "${outIDs[@]}"; do
	echo "$outID"
	pw-link -d $outID
done

pw-link REAPER:out1 $default:playback_FL
pw-link REAPER:out2 $default:playback_FR
