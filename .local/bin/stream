#!/bin/bash
ifinstalled xsel webtorrent mpv || exit 1
clipboard=$(xsel -ob)
if [ -n "$clipboard" ]
then
	if [[ "$clipboard" = *"magnet:?"* ]]; then
		choice=$(webtorrent --mpv $clipboard --select | awk '/^[0-9]/' | dmenu -i -p "Index:" )
		index=$(echo $choice | sed -e "s/ .*//g")
		webtorrent --mpv $clipboard --select $index
		# TODO: sort out proper or comparison to avoid duplicate code
	elif [[ "$clipboard" = *".torrent"* ]]; then
		choice=$(webtorrent --mpv $clipboard --select | awk '/^[0-9]/' | dmenu -i -p "Index:" )
		index=$(echo $choice | sed -e "s/ .*//g")
		webtorrent --mpv $clipboard --select $index
	else
		mpv $clipboard || notify-send 'Clipboard not valid'
	fi
else
	notify-send 'Clipboard empty'
fi
