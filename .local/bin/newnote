#!/usr/bin/env bash

# The colon can be used as true, so no items are needed for input to dmenu
name=$(: | dmenu -p "Enter filename (excluding .md): ")

if [[ -z $name ]]; then
	echo "No filename given. Exiting."
	exit 1
fi

cd ~/WIKI/

# Start the tmux session if not running
if ! tmux has-session -t wiki 2>/dev/null; then
	echo "tmux session wiki not running, starting it"
	tmux new-session -s wiki -d
else
	echo "tmux session wiki is running"
fi

# Check if (n)vim is running in the tmux session
currentCommand=$(tmux list-panes -t wiki -F '#{pane_current_command}')
if [[ "$currentCommand" == *"vim"* ]]; then
	echo "(n)vim is running"
	tmux send-keys -t wiki Escape ":e $path" Enter
else
	echo "(n)vim is not running"
	tmux send-keys -t wiki "cd ~/WIKI/; nvim \"$path\"" Enter
fi

# Attach to tmux session
echo "$TERMINAL" "Opening $path in (n)vim"
$TERMINAL -e tmux attach -t wiki
