#!/bin/bash

# Define the trash directory
XDG_DATA_HOME=${XDG_DATA_HOME:-$HOME/.local/share}
TRASH_DIR="$XDG_DATA_HOME/Trash"
FILES_DIR="$TRASH_DIR/files"
INFO_DIR="$TRASH_DIR/info"

# Create the directories if they do not exist
mkdir -p "$FILES_DIR"
mkdir -p "$INFO_DIR"

# Function to move a file to the trash and create an info file
move_to_trash() {
    local file_path=$(realpath "$1")
    local filename=$(basename "$file_path")
    local deletion_date=$(date +"%Y-%m-%dT%H:%M:%S")

    # Replace spaces with %20 for the trashinfo file
    local trashinfo_path=${file_path// /%20}

    # Move the file to the trash files directory
    mv "$file_path" "$FILES_DIR/"

    # Create the info file
    echo "[Trash Info]" > "$INFO_DIR/${filename}.trashinfo"
    echo "Path=$trashinfo_path" >> "$INFO_DIR/${filename}.trashinfo"
    echo "DeletionDate=$deletion_date" >> "$INFO_DIR/${filename}.trashinfo"
}

# Process each file passed to the script
for file in "$@"; do
    if [[ -e "$file" ]]; then
        move_to_trash "$file"
    else
        echo "File not found: $file"
    fi
done
