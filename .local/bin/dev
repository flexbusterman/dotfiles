#!/bin/sh
notefile=$(find ~/Dropbox/NOTES/ -maxdepth 1 -type f -iname "*$1*" | head -n 1)
folder=~/.local/src/$1
startBrowser=true

# if $1 isn't a folder, exit
if [ ! -d "$folder" ]; then
	notify-send "Folder $folder doesn't exist"
	exit 1
fi

if [ $1 == "mind" ]; then
	notefile="/home/$USER/Dropbox/NOTES/MIND.md"
	st -t Server -e zsh -c "cd ~/.local/src/mind; source /usr/share/nvm/init-nvm.sh; nvm use v14.21.3; npm run dev" &
	port=3000
elif [ $1 == "react" ]; then
	folder=~/.local/src/donewithit/
	notefile="/home/$USER/Dropbox/NOTES/React Native.md"
	st -t Server -e zsh -c "cd $folder; npm run web" &
	port=19006
	startBrowser=false
elif [ $1 == "training" ]; then
	java=/usr/lib/jvm/java-17-openjdk
	folder=~/.local/src/training/
	notefile="/home/$USER/Dropbox/NOTES/trainingapp.md"
	# st -t Server -e zsh -c "cd $folder; JAVA_HOME=$java; npx expo run:android" &
	st -t Server -e zsh -c "cd $folder; JAVA_HOME=$java; npm run web" &
	# port=19006
	startBrowser=false
elif [ $1 == "train" ]; then
	# java=/usr/lib/jvm/java-17-openjdk
	folder=~/.local/src/train/
	notefile="/home/$USER/Dropbox/NOTES/trainingapp.md"
	# st -t Server -e zsh -c "cd $folder; JAVA_HOME=$java; npx expo run:android" &
	st -t Server -e zsh -c "cd $folder; npm run web" &
	# port=19006
	startBrowser=false
elif [ $1 == "sandhamn" ]; then
	st -t Server -e zsh -c "cd ~/.local/src/sandhamn; source /usr/share/nvm/init-nvm.sh; nvm use v16.18.1; npm run dev" &
	port=3000
elif [ $1 == "parking" ]; then
	st -t Server -e zsh -c "cd ~/.local/src/parking; nvm use v18.17.1; npx expo start --web" &
	port=19006
elif [ $1 == "react-test" ]; then
	notefile="/home/$USER/Dropbox/NOTES/React.md"
	st -t Server -e zsh -c "cd ~/.local/src/react-test/; yarn dev" &
	port=5173
else
	st -t Server -e zsh -c "cd ~/.local/src/$1; npm run dev" &
	port=3000
fi
echo $folder > ~/.workdir
st -t Timer -e zsh -c "termdown --no-figlet" &
sleep 0.2 && st -t Git -e zsh -c "cd $folder; zsh" &
st -t Notes -e zsh -c "cd ~/Dropbox/NOTES/; nvim \"$notefile\"" &
[[ $startBrowser == true ]] && sleep 1.5 && firefox --new-window http://localhost:$port &
# sleep 3 && kitty zsh -c "cd $([[$folder]] || ~/.local/src/$1); nvim -c \"e .\"" &
# if folder is not set, open nvim in ~/.local/src/$1
sleep 3 && st -t $1 -e zsh -c "cd $folder; nvim -c \"e .\""
