#!/usr/bin/env bash

device=$1

if [[ $(pactl list sinks | grep -i "Bluetooth") ]]; then
	echo "Device is connected"
	notify-send "Device is connected"
	exit 0
fi

isPowered(){
	[[ $(bluetoothctl show | awk '/Powered/ {print $2}') == "yes" ]] && powered=true
}

isUnPowered(){
	[[ $(bluetoothctl show | awk '/Powered/ {print $2}') == "no" ]] && powered=false
}

isPowered
isUnPowered

echo "Bluetooth controller powered $powered"

powerOnAndConnect() {
	if [[ $powered == "false" ]]; then
		echo "Bluetooth controller is not powered"
		rfkill unblock bluetooth
		bluetoothctl power on
		sleep 1
		isPowered
		[[ $powered == "true" ]] && echo "Bluetooth controller powered on"
	sleep 3
	fi
	bluetoothctl connect $device && (notify-send "Connection successful"; pgrep reaper && reaperconnect) || notify-send "Failed to connect"
	# sleep 2
	# [[ $? ]] && notify-send "Connection successful"
}

powerOnAndConnect
