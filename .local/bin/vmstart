#!/usr/bin/env bash

# Use an array to store VMs
vms=()
# Read each VM name into the array
while IFS= read -r vm; do
    vms+=("$vm")
done < <(virsh --connect qemu:///system list --all | awk -F'\t+|[[:space:]]{2,}' '!/Name/ {print $2}' | awk '!/^$/')

# Append "routervms" to the array
vms+=("routervms")

# Join array into lines (for wmenu)
vmname=$(printf "%s\n" "${vms[@]}" | wmenu -i -f "BigBlueTerm437 Nerd Font Mono 9" -n "#FFFFFF" -p "Start VM")

if [[ "$vmname" == "routervms" ]]; then
	notify-send "Starting routervms headless"
	virsh --connect qemu:///system start "Debian Router"
	virsh --connect qemu:///system start "Debian TTY1"
	virsh --connect qemu:///system start "Debian TTY2"
	# VBoxManage startvm --type=headless 'Debian Router'
	# VBoxManage startvm --type=headless 'Debian TTY 1'
	# VBoxManage startvm --type=headless 'Debian TTY 2'
	sleep 10
	kitty -e tmuxsession router &
	tmux send-keys -t router C-c
	tmux send-keys -t router "ssh router" Enter
else
	# VBoxManage startvm "$vmname"
	virsh --connect qemu:///system start "$vmname"
	virt-manager --connect qemu:///system --show-domain-console "$vmname"
fi
