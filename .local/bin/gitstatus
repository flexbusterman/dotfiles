#!/bin/sh

eval "$(ssh-agent -s)" &> /dev/null
ssh-add ~/.ssh/git &> /dev/null

cd $1
folders=$(find ~+ -mindepth 1 -maxdepth 1 -type d) &> /dev/null

for folder in $folders
do
	cd $folder
	git remote update
	if [[ $(git status | grep modified) ]]; then
		echo "Changes in $folder"
		# pull from github
		git pull --force
		# if folder contains file config.def.h or config.h
		if [[ -f config.def.h ]] || [[ -f config.h ]]; then
			# compile and install
			make clean install
		fi
	fi
done

