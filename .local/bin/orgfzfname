#!/bin/sh
cd ~/ORGMODE/

file="$(fzf)"
if [[ -z $file ]]; then
	echo "No file selected, exiting"
	exit 1;
fi

# if tmux session orgmode is not running, start it
if ! tmux has-session -t orgmode 2>/dev/null; then
	echo "tmux session orgmode not running, starting it"
	tmux new-session -s orgmode -d
else
	echo "tmux session orgmode is running"
fi

# get current command for future vim check
currentCommand=$(tmux list-panes -t orgmode -F '#{pane_current_command}')

# check if nvim is running
if [[ "$currentCommand" == *"vim"* ]]; then
	echo "(n)vim is running"
	# open file in a tab or switch to tab with buffer
	tmux send-keys -t orgmode Escape ":e $file" Enter
else
	echo "(n)vim is not running"
	# start, send output to dev/null and disown
	tmux send-keys -t orgmode C-c
	sleep 0.1
	tmux send-keys -t orgmode "cd ~/ORGMODE/; nvim \"$file\"" Enter
fi

(setsid $TERMINAL -e tmux attach -t orgmode >/dev/null 2>&1 &)
